<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - EngineerPulse</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="js/data-manager.js"></script>
    <script src="js/data-widget.js"></script>
    <script src="js/help-system.js"></script>
    <script src="js/navigation-manager.js"></script>
    <script src="js/dark-mode.js"></script>
    <script src="js/performance-monitor.js"></script>
</head>
<body class="bg-gray-50">
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
        <!-- Mobile Menu Button -->
        <button class="mobile-menu-button md:hidden absolute top-4 right-4 z-10" onclick="toggleMobileMenu()">
            <i data-feather="x" class="w-5 h-5"></i>
        </button>
        
        <!-- Logo Section -->
        <div class="flex items-center space-x-2 mb-8">
            <i data-feather="activity" class="w-6 h-6 text-indigo-600"></i>
            <h1 class="text-xl font-semibold">EngineerPulse</h1>
        </div>

        <!-- User Profile Section -->
        <div class="bg-gray-50 rounded-lg p-4 mb-6">
            <div class="flex items-center space-x-3 mb-4">
                <img src="http://static.photos/people/200x200/42" alt="User" class="w-12 h-12 rounded-full">
                <div>
                    <h3 class="font-medium">Alex Johnson</h3>
                    <p class="text-sm text-gray-500">Senior Software Engineer</p>
                </div>
            </div>
        </div>

        <!-- Navigation Links -->
        <nav class="space-y-1 mb-8">
            <a href="index.html" class="sidebar-link flex items-center space-x-2 text-gray-600 hover:text-indigo-600">
                <i data-feather="home" class="w-4 h-4"></i>
                <span>Dashboard</span>
            </a>
            <a href="code-activity.html" class="sidebar-link flex items-center space-x-2 text-gray-600 hover:text-indigo-600">
                <i data-feather="github" class="w-4 h-4"></i>
                <span>Code Activity</span>
                <span class="ml-auto bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full pulse-animation">12</span>
            </a>
            <a href="project-tasks.html" class="sidebar-link flex items-center space-x-2 text-gray-600 hover:text-indigo-600">
                <i data-feather="trello" class="w-4 h-4"></i>
                <span>Project Tasks</span>
                <span class="ml-auto bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full pulse-animation">3</span>
            </a>
            <a href="metrics.html" class="sidebar-link flex items-center space-x-2 text-gray-600 hover:text-indigo-600">
                <i data-feather="bar-chart-2" class="w-4 h-4"></i>
                <span>Metrics</span>
            </a>
            <a href="roadmap.html" class="sidebar-link flex items-center space-x-2 text-gray-600 hover:text-indigo-600">
                <i data-feather="map" class="w-4 h-4"></i>
                <span>Roadmap</span>
            </a>
            <a href="add-data.html" class="sidebar-link flex items-center space-x-2 text-gray-600 hover:text-indigo-600">
                <i data-feather="database" class="w-4 h-4"></i>
                <span>Add Data</span>
                <span class="ml-auto bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full pulse-animation">New</span>
            </a>
            <a href="settings.html" class="sidebar-link flex items-center space-x-2 text-indigo-600 font-medium active">
                <i data-feather="settings" class="w-4 h-4"></i>
                <span>Settings</span>
            </a>
        </nav>

        <!-- Settings Navigation -->
        <div class="bg-gray-50 rounded-lg p-4 mb-6">
            <h3 class="font-medium mb-3">Settings Categories</h3>
            <div class="space-y-1">
                <a href="#profile" class="block text-sm text-indigo-600 font-medium hover:text-indigo-800">Profile</a>
                <a href="#preferences" class="block text-sm text-gray-600 hover:text-indigo-600">Preferences</a>
                <a href="#notifications" class="block text-sm text-gray-600 hover:text-indigo-600">Notifications</a>
                <a href="#integrations" class="block text-sm text-gray-600 hover:text-indigo-600">Integrations</a>
                <a href="#data-management" class="block text-sm text-gray-600 hover:text-indigo-600">Data Management</a>
                <a href="#security" class="block text-sm text-gray-600 hover:text-indigo-600">Security</a>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="space-y-2">
            <button class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 px-3 py-2 rounded-md flex items-center justify-center transition-colors duration-200">
                <i data-feather="refresh-cw" class="w-4 h-4 mr-2"></i>
                <span>Refresh</span>
            </button>
            <button id="theme-toggle" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 px-3 py-2 rounded-md flex items-center justify-center transition-colors duration-200">
                <i data-feather="moon" class="w-4 h-4 mr-2"></i>
                <span>Dark Mode</span>
            </button>
        </div>
    </aside>

    <!-- Mobile Sidebar Overlay -->
    <div class="sidebar-overlay" onclick="toggleMobileMenu()"></div>

    <!-- Mobile Menu Button -->
    <button class="mobile-menu-button fixed top-4 left-4 z-50 md:hidden bg-indigo-600 text-white p-2 rounded-md" onclick="toggleMobileMenu()">
        <i data-feather="menu" class="w-5 h-5"></i>
    </button>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <header class="header bg-indigo-600 text-white shadow-md">
            <div class="px-6 py-4 flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold">Settings</h1>
                    <p class="text-indigo-200">Customize your EngineerPulse experience</p>
                </div>
                <div class="flex items-center space-x-3">
                    <button class="btn btn-outline text-sm bg-white text-indigo-600 hover:bg-indigo-50">
                        <i data-feather="download" class="w-4 h-4 mr-1"></i>
                        Export Settings
                    </button>
                    <button class="btn btn-primary text-sm bg-indigo-800 hover:bg-indigo-900">
                        <i data-feather="save" class="w-4 h-4 mr-1"></i>
                        Save Changes
                    </button>
                    <div class="relative group">
                        <img src="http://static.photos/people/200x200/42" alt="User" class="w-8 h-8 rounded-full cursor-pointer">
                        <div class="absolute right-0 bottom-0 bg-green-500 rounded-full w-3 h-3 border-2 border-white"></div>
                        <div class="absolute right-0 top-full mt-2 w-48 bg-white rounded-lg shadow-lg py-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-20">
                            <a href="settings.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Profile</a>
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Notifications</a>
                            <a href="settings.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Settings</a>
                            <div class="border-t my-1"></div>
                            <a href="#" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100">Logout</a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main class="p-6">

            <!-- Profile Settings -->
            <div id="profile" class="bg-white rounded-lg shadow-sm p-6 mb-6">
                <h3 class="font-semibold text-lg mb-4">Profile Information</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-input" value="Alex Johnson" placeholder="Enter your full name">
                    </div>
                    
                    <div>
                        <label class="form-label">Email Address</label>
                        <input type="email" class="form-input" value="alex.johnson@company.com" placeholder="Enter your email">
                    </div>
                    
                    <div>
                        <label class="form-label">Job Title</label>
                        <input type="text" class="form-input" value="Senior Software Engineer" placeholder="Enter your job title">
                    </div>
                    
                    <div>
                        <label class="form-label">Team</label>
                        <select class="form-input">
                            <option>Engineering Team</option>
                            <option>Frontend Team</option>
                            <option>Backend Team</option>
                            <option>DevOps Team</option>
                        </select>
                    </div>
                    
                    <div class="md:col-span-2">
                        <label class="form-label">Bio</label>
                        <textarea class="form-input" rows="3" placeholder="Tell us about yourself...">Passionate software engineer with 8+ years of experience in full-stack development and team leadership.</textarea>
                    </div>
                </div>

                <div class="mt-6 pt-6 border-t border-gray-200">
                    <h4 class="font-medium mb-4">Profile Picture</h4>
                    <div class="flex items-center space-x-4">
                        <img src="http://static.photos/people/200x200/42" alt="Profile" class="w-20 h-20 rounded-full">
                        <div>
                            <button class="btn btn-outline text-sm mb-2">
                                <i data-feather="upload" class="w-4 h-4 mr-1"></i>
                                Upload New Picture
                            </button>
                            <p class="text-sm text-gray-500">JPG, PNG or GIF. Max size 2MB.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preferences -->
            <div id="preferences" class="bg-white rounded-lg shadow-sm p-6 mb-6">
                <h3 class="font-semibold text-lg mb-4">Preferences</h3>
                
                <div class="space-y-6">
                    <div>
                        <h4 class="font-medium mb-3">Appearance</h4>
                        <div class="space-y-3">
                            <label class="flex items-center space-x-2">
                                <input type="radio" name="theme" value="light" checked class="text-indigo-600">
                                <span class="text-sm">Light Mode</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="radio" name="theme" value="dark" class="text-indigo-600">
                                <span class="text-sm">Dark Mode</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="radio" name="theme" value="system" class="text-indigo-600">
                                <span class="text-sm">System Default</span>
                            </label>
                        </div>
                    </div>

                    <div>
                        <h4 class="font-medium mb-3">Dashboard Layout</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="form-label">Default Page</label>
                                <select class="form-input">
                                    <option>Dashboard</option>
                                    <option>Code Activity</option>
                                    <option>Project Tasks</option>
                                    <option>Metrics</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Items per Page</label>
                                <select class="form-input">
                                    <option>10</option>
                                    <option selected>25</option>
                                    <option>50</option>
                                    <option>100</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h4 class="font-medium mb-3">Date & Time</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="form-label">Timezone</label>
                                <select class="form-input">
                                    <option>UTC</option>
                                    <option selected>Europe/London</option>
                                    <option>America/New_York</option>
                                    <option>America/Los_Angeles</option>
                                    <option>Asia/Tokyo</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Date Format</label>
                                <select class="form-input">
                                    <option>DD/MM/YYYY</option>
                                    <option selected>MM/DD/YYYY</option>
                                    <option>YYYY-MM-DD</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notifications -->
            <div id="notifications" class="bg-white rounded-lg shadow-sm p-6 mb-6">
                <h3 class="font-semibold text-lg mb-4">Notification Preferences</h3>
                
                <div class="space-y-6">
                    <div>
                        <h4 class="font-medium mb-3">Email Notifications</h4>
                        <div class="space-y-3">
                            <label class="flex items-center justify-between">
                                <span class="text-sm">Daily summary reports</span>
                                <input type="checkbox" checked class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                            </label>
                            <label class="flex items-center justify-between">
                                <span class="text-sm">Weekly performance insights</span>
                                <input type="checkbox" checked class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                            </label>
                            <label class="flex items-center justify-between">
                                <span class="text-sm">Goal milestone notifications</span>
                                <input type="checkbox" class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                            </label>
                            <label class="flex items-center justify-between">
                                <span class="text-sm">Team activity updates</span>
                                <input type="checkbox" class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                            </label>
                        </div>
                    </div>

                    <div>
                        <h4 class="font-medium mb-3">Push Notifications</h4>
                        <div class="space-y-3">
                            <label class="flex items-center justify-between">
                                <span class="text-sm">Task assignments</span>
                                <input type="checkbox" checked class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                            </label>
                            <label class="flex items-center justify-between">
                                <span class="text-sm">Code review requests</span>
                                <input type="checkbox" checked class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                            </label>
                            <label class="flex items-center justify-between">
                                <span class="text-sm">Build failures</span>
                                <input type="checkbox" checked class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                            </label>
                            <label class="flex items-center justify-between">
                                <span class="text-sm">Mentions in comments</span>
                                <input type="checkbox" class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                            </label>
                        </div>
                    </div>

                    <div>
                        <h4 class="font-medium mb-3">Notification Schedule</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="form-label">Quiet Hours Start</label>
                                <input type="time" class="form-input" value="22:00">
                            </div>
                            <div>
                                <label class="form-label">Quiet Hours End</label>
                                <input type="time" class="form-input" value="08:00">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Integrations -->
            <div id="integrations" class="bg-white rounded-lg shadow-sm p-6 mb-6">
                <h3 class="font-semibold text-lg mb-4">Connected Integrations</h3>
                
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div class="bg-green-100 p-2 rounded-full">
                                <i data-feather="github" class="w-5 h-5 text-green-600"></i>
                            </div>
                            <div>
                                <h4 class="font-medium">GitHub</h4>
                                <p class="text-sm text-gray-600">Connected to alex-johnson/repositories</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-sm text-green-600">Connected</span>
                            <button class="btn btn-outline text-sm">Configure</button>
                        </div>
                    </div>

                    <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div class="bg-blue-100 p-2 rounded-full">
                                <i data-feather="trello" class="w-5 h-5 text-blue-600"></i>
                            </div>
                            <div>
                                <h4 class="font-medium">Jira</h4>
                                <p class="text-sm text-gray-600">Connected to company.atlassian.net</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-sm text-green-600">Connected</span>
                            <button class="btn btn-outline text-sm">Configure</button>
                        </div>
                    </div>

                    <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div class="bg-gray-100 p-2 rounded-full">
                                <i data-feather="message-circle" class="w-5 h-5 text-gray-600"></i>
                            </div>
                            <div>
                                <h4 class="font-medium">Slack</h4>
                                <p class="text-sm text-gray-600">Not connected</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-sm text-gray-500">Disconnected</span>
                            <button class="btn btn-primary text-sm">Connect</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Management -->
            <div id="data-management" class="mb-6">
                <div id="dataWidget"></div>
            </div>

            <!-- Security -->
            <div id="security" class="bg-white rounded-lg shadow-sm p-6 mb-6">
                <h3 class="font-semibold text-lg mb-4">Security Settings</h3>
                
                <div class="space-y-6">
                    <div>
                        <h4 class="font-medium mb-3">Password</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="form-label">Current Password</label>
                                <input type="password" class="form-input" placeholder="Enter current password">
                            </div>
                            <div>
                                <label class="form-label">New Password</label>
                                <input type="password" class="form-input" placeholder="Enter new password">
                            </div>
                            <div>
                                <label class="form-label">Confirm New Password</label>
                                <input type="password" class="form-input" placeholder="Confirm new password">
                            </div>
                            <button class="btn btn-primary text-sm">Update Password</button>
                        </div>
                    </div>

                    <div>
                        <h4 class="font-medium mb-3">Two-Factor Authentication</h4>
                        <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                            <div>
                                <p class="font-medium">Authenticator App</p>
                                <p class="text-sm text-gray-600">Add an extra layer of security to your account</p>
                            </div>
                            <button class="btn btn-primary text-sm">Enable 2FA</button>
                        </div>
                    </div>

                    <div>
                        <h4 class="font-medium mb-3">API Access</h4>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium">Personal Access Token</p>
                                    <p class="text-sm text-gray-600">Use this token to access the API programmatically</p>
                                </div>
                                <button class="btn btn-outline text-sm">Generate Token</button>
                            </div>
                            
                            <div>
                                <h5 class="font-medium mb-2">Active API Keys</h5>
                                <div class="space-y-2">
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div>
                                            <p class="text-sm font-medium">Production API Key</p>
                                            <p class="text-xs text-gray-500">Created on Dec 1, 2024 • Last used 2 hours ago</p>
                                        </div>
                                        <button class="text-red-600 hover:text-red-800 text-sm">Revoke</button>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div>
                                            <p class="text-sm font-medium">Development API Key</p>
                                            <p class="text-xs text-gray-500">Created on Nov 15, 2024 • Last used 1 day ago</p>
                                        </div>
                                        <button class="text-red-600 hover:text-red-800 text-sm">Revoke</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h4 class="font-medium mb-3">Login Activity</h4>
                        <div class="space-y-2">
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div>
                                    <p class="text-sm font-medium">Current Session</p>
                                    <p class="text-xs text-gray-500">Chrome on macOS • London, UK • Active now</p>
                                </div>
                                <span class="text-xs text-green-600">Current</span>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div>
                                    <p class="text-sm font-medium">Previous Session</p>
                                    <p class="text-xs text-gray-500">Chrome on macOS • London, UK • 2 hours ago</p>
                                </div>
                                <button class="text-red-600 hover:text-red-800 text-xs">Terminate</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Danger Zone -->
            <div class="bg-red-50 border border-red-200 rounded-lg p-6">
                <h3 class="font-semibold text-lg text-red-900 mb-4">Danger Zone</h3>
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-medium text-red-900">Export Account Data</p>
                            <p class="text-sm text-red-700">Download all your data in JSON format</p>
                        </div>
                        <button class="btn btn-outline text-sm border-red-300 text-red-700 hover:bg-red-50">
                            Export Data
                        </button>
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-medium text-red-900">Delete Account</p>
                            <p class="text-sm text-red-700">Permanently delete your account and all associated data</p>
                        </div>
                        <button class="btn text-sm bg-red-600 text-white hover:bg-red-700">
                            Delete Account
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

        </main>
    </div>

    <script>
        feather.replace();

        // Dark mode is now handled by DarkModeManager
        // Update theme preference setting when theme changes
        window.addEventListener('themeChanged', (e) => {
            console.log('Theme changed to:', e.detail.theme);
            
            // Update the theme radio buttons in preferences section
            const themeRadios = document.querySelectorAll('input[name="theme"]');
            themeRadios.forEach(radio => {
                if (radio.value === e.detail.theme) {
                    radio.checked = true;
                } else {
                    radio.checked = false;
                }
            });
        });
        
        // Listen for theme preference changes in settings
        document.querySelectorAll('input[name="theme"]').forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.checked && window.darkModeManager) {
                    window.darkModeManager.setTheme(this.value);
                }
            });
        });

        // Refresh button functionality
        document.querySelector('button.bg-indigo-700').addEventListener('click', function() {
            const icon = this.querySelector('i');
            icon.classList.add('spin');
            setTimeout(() => {
                icon.classList.remove('spin');
                // Add fade-in animation to content
                document.querySelectorAll('.bg-white').forEach(el => {
                    el.classList.add('fade-in');
                    setTimeout(() => el.classList.remove('fade-in'), 500);
                });
            }, 1000);
        });

        // Highlight active sidebar link
        const currentPage = window.location.pathname.split('/').pop() || 'index.html';
        document.querySelectorAll('.sidebar-link').forEach(link => {
            if (link.getAttribute('href') === currentPage) {
                link.classList.add('active');
            }
        });

        // Settings navigation
        document.querySelectorAll('a[href^="#"]').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                    
                    // Update active state
                    document.querySelectorAll('a[href^="#"]').forEach(l => l.classList.remove('text-indigo-600', 'font-medium'));
                    this.classList.add('text-indigo-600', 'font-medium');
                }
            });
        });

        // Save settings functionality
        document.querySelector('.btn-primary').addEventListener('click', function() {
            // Simulate saving
            this.textContent = 'Saving...';
            this.disabled = true;
            
            setTimeout(() => {
                this.innerHTML = '<i data-feather="check" class="w-4 h-4 mr-1"></i>Saved';
                feather.replace();
                
                setTimeout(() => {
                    this.innerHTML = '<i data-feather="save" class="w-4 h-4 mr-1"></i>Save Changes';
                    this.disabled = false;
                    feather.replace();
                }, 2000);
            }, 1500);
        });

        // Form interactions
        document.querySelectorAll('input, select, textarea').forEach(input => {
            input.addEventListener('change', function() {
                // Mark form as dirty
                console.log('Settings changed');
            });
        });

        // Initialize Data Management System
        let dataManager, dataWidget;
        
        try {
            // Initialize the data manager
            dataManager = new DataManager();
            
            // Initialize the data widget
            const dataContainer = document.getElementById('dataWidget');
            if (dataContainer) {
                dataWidget = new DataWidget(dataContainer, dataManager);
                
                // Show widget by default
                dataWidget.show();
                
                // Handle export button in header
                const exportBtn = document.querySelector('.btn-outline');
                if (exportBtn) {
                    exportBtn.addEventListener('click', () => {
                        dataWidget.switchTab('export');
                        dataWidget.show();
                        document.getElementById('data-management').scrollIntoView({
                            behavior: 'smooth'
                        });
                    });
                }
                
                // Listen for successful exports/imports
                dataManager.on('onExportComplete', (data) => {
                    console.log('Export completed:', data);
                });
                
                dataManager.on('onImportComplete', (data) => {
                    console.log('Import completed:', data);
                    // Refresh the page data after import
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                });
            }
            
        } catch (error) {
            console.error('Error initializing data management system:', error);
            // Show a fallback message
            const dataContainer = document.getElementById('dataWidget');
            if (dataContainer) {
                dataContainer.innerHTML = `
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6">
                        <div class="flex items-center space-x-3">
                            <i data-feather="alert-triangle" class="w-6 h-6 text-yellow-600"></i>
                            <div>
                                <h4 class="font-medium text-yellow-800">Data Management Unavailable</h4>
                                <p class="text-sm text-yellow-700 mt-1">
                                    The data management system could not be loaded. Please refresh the page and try again.
                                </p>
                            </div>
                        </div>
                    </div>
                `;
                feather.replace();
            }
        }

        // Enhanced Export Settings functionality
        document.querySelector('.btn-outline').addEventListener('click', function(e) {
            e.preventDefault();
            
            if (dataWidget) {
                // Use the data management system
                dataWidget.switchTab('export');
                dataWidget.show();
                document.getElementById('data-management').scrollIntoView({
                    behavior: 'smooth'
                });
            } else {
                // Fallback export
                const settings = {
                    profile: {
                        name: document.querySelector('input[value="Alex Johnson"]')?.value,
                        email: document.querySelector('input[value="alex.johnson@company.com"]')?.value,
                        jobTitle: document.querySelector('input[value="Senior Software Engineer"]')?.value,
                        team: document.querySelector('select')?.value,
                        bio: document.querySelector('textarea')?.value
                    },
                    preferences: {
                        theme: document.querySelector('input[name="theme"]:checked')?.value,
                        defaultPage: document.querySelector('select')?.value,
                        timezone: document.querySelector('select')?.value
                    },
                    notifications: {},
                    integrations: {}
                };
                
                const blob = new Blob([JSON.stringify(settings, null, 2)], {
                    type: 'application/json'
                });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `engineerpulse-settings-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                // Show notification
                const notification = document.createElement('div');
                notification.className = 'fixed top-4 right-4 bg-green-500 text-white p-4 rounded-lg shadow-lg z-50';
                notification.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <i data-feather="download" class="w-5 h-5"></i>
                        <span class="text-sm">Settings exported successfully</span>
                    </div>
                `;
                document.body.appendChild(notification);
                feather.replace();
                
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 3000);
            }
        });

        // Initialize Help System
        let helpSystem;
        try {
            helpSystem = new HelpSystem();
            
            // Register page-specific tour for settings page
            helpSystem.registerTour('settings-configuration', {
                name: 'Settings & Configuration',
                description: 'Customize your EngineerPulse experience',
                steps: [
                    {
                        element: '#profile',
                        title: 'Profile Settings',
                        content: 'Update your profile information, upload a profile picture, and manage your basic account details.',
                        position: 'bottom'
                    },
                    {
                        element: '#preferences',
                        title: 'Preferences',
                        content: 'Customize appearance, dashboard layout, date formats, and other personal preferences.',
                        position: 'top'
                    },
                    {
                        element: '#integrations',
                        title: 'Connected Integrations',
                        content: 'Connect your development tools like GitHub, Jira, and Slack for automatic data collection.',
                        position: 'top'
                    },
                    {
                        element: '#dataWidget',
                        title: 'Data Management',
                        content: 'Configure data retention, export schedules, backup settings, and import/export your data.',
                        position: 'top'
                    },
                    {
                        element: '#security',
                        title: 'Security Settings',
                        content: 'Manage passwords, enable two-factor authentication, generate API keys, and monitor login activity.',
                        position: 'top'
                    }
                ]
            });
            
            // Add keyboard shortcut for help
            document.addEventListener('keydown', (e) => {
                if (e.key === 'F1') {
                    e.preventDefault();
                    helpSystem.toggleHelpPanel();
                }
            });
            
        } catch (error) {
            console.error('Error initializing help system:', error);
        }

        // Mobile Menu Functions
        function toggleMobileMenu() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            
            sidebar.classList.toggle('show');
            overlay.classList.toggle('show');
        }

        // Close mobile menu when clicking sidebar links
        document.querySelectorAll('.sidebar-link').forEach(link => {
            link.addEventListener('click', () => {
                const sidebar = document.querySelector('.sidebar');
                const overlay = document.querySelector('.sidebar-overlay');
                
                sidebar.classList.remove('show');
                overlay.classList.remove('show');
            });
        });

        // Close mobile menu on window resize
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 768) {
                const sidebar = document.querySelector('.sidebar');
                const overlay = document.querySelector('.sidebar-overlay');
                
                sidebar.classList.remove('show');
                overlay.classList.remove('show');
            }
        });
    </script>
</body>
</html>