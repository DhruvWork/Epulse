<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metrics - Sprint Layer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/goals-manager.js"></script>
    <script src="js/goals-widget.js"></script>
    <script src="js/charts-manager.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="js/help-system.js"></script>
    <script src="js/navigation-manager.js"></script>
    <script src="js/dark-mode.js"></script>
    <script src="js/performance-monitor.js"></script>
</head>
<body class="bg-gray-50">
    <!-- Mobile Sidebar Overlay -->
    <div class="sidebar-overlay fixed inset-0 bg-black bg-opacity-50 z-40 hidden" onclick="toggleMobileMenu()"></div>

    <!-- Sidebar -->
    <aside class="sidebar fixed left-0 top-0 h-full w-64 bg-white shadow-lg z-50 transform -translate-x-full md:translate-x-0 transition-transform duration-300">
        <!-- Logo and Brand -->
        <div class="flex items-center space-x-2 p-4 border-b border-gray-200">
            <i data-feather="activity" class="w-6 h-6 text-indigo-600"></i>
            <h1 class="text-xl font-semibold text-gray-800">Sprint Layer</h1>
        </div>

        <!-- User Profile -->
        <div class="p-4 border-b border-gray-200">
            <div class="flex items-center space-x-3">
                <div class="relative">
                    <img src="http://static.photos/people/200x200/42" alt="User" class="w-10 h-10 rounded-full">
                    <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></div>
                </div>
                <div class="flex-1 min-w-0">
                    <h3 class="font-medium text-gray-900 truncate">Alex Johnson</h3>
                    <p class="text-sm text-gray-500 truncate">Senior Software Engineer</p>
                </div>
            </div>
        </div>

        <!-- Navigation Menu -->
        <nav class="flex-1 overflow-y-auto p-4">
            <div class="space-y-1">
                <a href="dashboard.html" class="sidebar-link flex items-center space-x-3 px-3 py-2 text-gray-600 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors">
                    <i data-feather="home" class="w-5 h-5"></i>
                    <span>Dashboard</span>
                </a>
                <a href="index.html" class="sidebar-link flex items-center space-x-3 px-3 py-2 text-gray-600 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors">
                    <i data-feather="map" class="w-5 h-5"></i>
                    <span>Roadmap</span>
                    <button class="ml-auto text-gray-400 hover:text-indigo-600 p-1" onclick="showCreateGoalDialog(event)" title="Create new roadmap goal">
                        <i data-feather="plus" class="w-3 h-3"></i>
                    </button>
                </a>
                <div class="space-y-2">
                    <a href="project-tasks.html" class="sidebar-link flex items-center space-x-3 px-3 py-2 text-gray-600 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors">
                        <i data-feather="trello" class="w-5 h-5"></i>
                        <span>Projects</span>
                        <span class="ml-auto bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full pulse-animation mr-1">3</span>
                        <button class="text-gray-400 hover:text-indigo-600 p-1" onclick="showCreateProjectDialog(event)" title="Create new project">
                            <i data-feather="plus" class="w-3 h-3"></i>
                        </button>
                    </a>
                    
                    <!-- Project Selection Dropdown -->
                    <div class="ml-8 mr-3">
                        <select id="project-selector" class="w-full text-sm border border-gray-200 rounded-md px-2 py-1 bg-white text-gray-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" onchange="switchProject(this.value)">
                            <option value="all">All Projects</option>
                            <option value="platform-modernization">Platform Modernization</option>
                            <option value="mobile-app">Mobile App Development</option>
                            <option value="data-analytics">Data Analytics Platform</option>
                            <option value="security-upgrade">Security Upgrade</option>
                        </select>
                    </div>
                </div>
                <a href="code-activity.html" class="sidebar-link flex items-center space-x-3 px-3 py-2 text-gray-600 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors ml-4">
                    <i data-feather="github" class="w-5 h-5"></i>
                    <span>Code Activity</span>
                    <span class="ml-auto bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full pulse-animation mr-1">12</span>
                    <button class="text-gray-400 hover:text-indigo-600 p-1" onclick="showCreateSprintDialog(event)" title="Create new sprint">
                        <i data-feather="plus" class="w-3 h-3"></i>
                    </button>
                </a>
                <a href="metrics.html" class="sidebar-link flex items-center space-x-3 px-3 py-2 text-indigo-600 bg-indigo-50 rounded-lg font-medium active">
                    <i data-feather="bar-chart-2" class="w-5 h-5"></i>
                    <span>Metrics</span>
                </a>
                <a href="add-data.html" class="sidebar-link flex items-center space-x-3 px-3 py-2 text-gray-600 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors">
                    <i data-feather="database" class="w-5 h-5"></i>
                    <span>Add Data</span>
                    <span class="ml-auto bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full pulse-animation">New</span>
                </a>
                <a href="settings.html" class="sidebar-link flex items-center space-x-3 px-3 py-2 text-gray-600 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors">
                    <i data-feather="settings" class="w-5 h-5"></i>
                    <span>Settings</span>
                </a>
            </div>

            <!-- Metrics Filters -->
            <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                <h3 class="font-medium mb-3 text-gray-900">Time Period</h3>
                <div class="space-y-2">
                    <label class="flex items-center space-x-2">
                        <input type="radio" name="period" value="week" checked class="text-indigo-600 focus:ring-indigo-500">
                        <span class="text-sm text-gray-700">This Week</span>
                    </label>
                    <label class="flex items-center space-x-2">
                        <input type="radio" name="period" value="month" class="text-indigo-600 focus:ring-indigo-500">
                        <span class="text-sm text-gray-700">This Month</span>
                    </label>
                    <label class="flex items-center space-x-2">
                        <input type="radio" name="period" value="quarter" class="text-indigo-600 focus:ring-indigo-500">
                        <span class="text-sm text-gray-700">This Quarter</span>
                    </label>
                    <label class="flex items-center space-x-2">
                        <input type="radio" name="period" value="custom" class="text-indigo-600 focus:ring-indigo-500">
                        <span class="text-sm text-gray-700">Custom Range</span>
                    </label>
                </div>
            </div>
        </nav>

        <!-- Action Buttons -->
        <div class="p-4 border-t border-gray-200">
            <button class="w-full bg-indigo-600 text-white px-4 py-2 rounded-lg flex items-center justify-center hover:bg-indigo-700 transition-colors mb-2">
                <i data-feather="download" class="w-4 h-4 mr-2"></i>
                <span>Export Report</span>
            </button>
            <button id="theme-toggle" class="w-full bg-gray-200 text-gray-700 px-4 py-2 rounded-lg flex items-center justify-center hover:bg-gray-300 transition-colors">
                <i data-feather="moon" class="w-4 h-4 mr-2"></i>
                <span>Dark Mode</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="md:ml-64 min-h-screen bg-gray-50">
        <!-- Mobile Header -->
        <header class="md:hidden bg-white shadow-sm border-b border-gray-200 px-4 py-3 flex items-center justify-between">
            <button class="mobile-menu-button text-gray-600 hover:text-gray-900" onclick="toggleMobileMenu()">
                <i data-feather="menu" class="w-6 h-6"></i>
            </button>
            <h1 class="font-semibold text-gray-900">Metrics</h1>
            <button class="bg-indigo-600 text-white px-3 py-1.5 rounded-md flex items-center hover:bg-indigo-700 transition-colors">
                <i data-feather="refresh-cw" class="w-4 h-4 mr-1"></i>
                <span class="hidden sm:inline">Refresh</span>
            </button>
        </header>

        <!-- Page Content -->
        <div class="p-4 md:p-6">
            <!-- Page Header -->
            <div class="hidden md:flex justify-between items-center mb-6">
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">Performance Metrics</h1>
                    <p class="text-gray-600 mt-1">Track your engineering productivity and performance indicators</p>
                </div>
                <div class="flex items-center space-x-3">
                    <select class="border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                        <option>Individual Metrics</option>
                        <option>Team Metrics</option>
                        <option>Project Metrics</option>
                    </select>
                    <button class="bg-indigo-600 text-white px-4 py-2 rounded-md flex items-center hover:bg-indigo-700 transition-colors">
                        <i data-feather="refresh-cw" class="w-4 h-4 mr-2"></i>
                        <span>Refresh</span>
                    </button>
                </div>
            </div>

            <!-- Mobile Page Header -->
            <div class="md:hidden mb-4">
                <p class="text-gray-600 text-sm">Track your engineering productivity and performance indicators</p>
                <div class="mt-3 flex items-center space-x-3">
                    <select class="flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                        <option>Individual Metrics</option>
                        <option>Team Metrics</option>
                        <option>Project Metrics</option>
                    </select>
                </div>
            </div>

            <!-- Key Performance Indicators -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="stat-card">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-semibold text-gray-700">Velocity</h3>
                        <div class="bg-indigo-100 p-2 rounded-full">
                            <i data-feather="trending-up" class="w-4 h-4 text-indigo-600"></i>
                        </div>
                    </div>
                    <div class="text-3xl font-bold text-gray-900 mb-2">42 pts</div>
                    <div class="flex items-center text-sm">
                        <span class="text-green-600 mr-1">↑ 12%</span>
                        <span class="text-gray-500">vs last sprint</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-semibold text-gray-700">Cycle Time</h3>
                        <div class="bg-blue-100 p-2 rounded-full">
                            <i data-feather="clock" class="w-4 h-4 text-blue-600"></i>
                        </div>
                    </div>
                    <div class="text-3xl font-bold text-gray-900 mb-2">3.2d</div>
                    <div class="flex items-center text-sm">
                        <span class="text-green-600 mr-1">↓ 0.8d</span>
                        <span class="text-gray-500">improvement</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-semibold text-gray-700">Code Quality</h3>
                        <div class="bg-green-100 p-2 rounded-full">
                            <i data-feather="shield-check" class="w-4 h-4 text-green-600"></i>
                        </div>
                    </div>
                    <div class="text-3xl font-bold text-gray-900 mb-2">92%</div>
                    <div class="flex items-center text-sm">
                        <span class="text-green-600 mr-1">↑ 3%</span>
                        <span class="text-gray-500">this month</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-semibold text-gray-700">Focus Time</h3>
                        <div class="bg-purple-100 p-2 rounded-full">
                            <i data-feather="target" class="w-4 h-4 text-purple-600"></i>
                        </div>
                    </div>
                    <div class="text-3xl font-bold text-gray-900 mb-2">6.4h</div>
                    <div class="flex items-center text-sm">
                        <span class="text-green-600 mr-1">↑ 18%</span>
                        <span class="text-gray-500">daily average</span>
                    </div>
                </div>
            </div>

            <!-- Enhanced Charts Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Velocity Trend -->
                <div class="bg-white rounded-lg shadow-sm p-6 chart-card">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold text-lg">Sprint Velocity</h3>
                        <div class="flex items-center space-x-2">
                            <button class="chart-action-btn" onclick="chartsManager.exportChart('velocityChart')" title="Export Chart">
                                <i data-feather="download" class="w-4 h-4"></i>
                            </button>
                            <button class="chart-action-btn" onclick="chartsManager.animateChart('velocityChart')" title="Animate">
                                <i data-feather="play" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="velocityChart"></canvas>
                    </div>
                </div>

                <!-- Burndown Chart -->
                <div class="bg-white rounded-lg shadow-sm p-6 chart-card">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold text-lg">Sprint Burndown</h3>
                        <div class="flex items-center space-x-2">
                            <button class="chart-action-btn" onclick="chartsManager.exportChart('burndownChart')" title="Export Chart">
                                <i data-feather="download" class="w-4 h-4"></i>
                            </button>
                            <button class="chart-action-btn" onclick="toggleRealTime('burndownChart')" title="Real-time Updates">
                                <i data-feather="refresh-cw" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="burndownChart"></canvas>
                    </div>
                </div>

                <!-- Cycle Time Distribution -->
                <div class="bg-white rounded-lg shadow-sm p-6 chart-card">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold text-lg">Cycle Time Analysis</h3>
                        <div class="flex items-center space-x-2">
                            <button class="chart-action-btn" onclick="chartsManager.exportChart('cycleTimeChart')" title="Export Chart">
                                <i data-feather="download" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="cycleTimeChart"></canvas>
                    </div>
                </div>

                <!-- Code Quality Radar -->
                <div class="bg-white rounded-lg shadow-sm p-6 chart-card">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold text-lg">Code Quality Metrics</h3>
                        <div class="flex items-center space-x-2">
                            <button class="chart-action-btn" onclick="chartsManager.exportChart('codeQualityChart')" title="Export Chart">
                                <i data-feather="download" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="codeQualityChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Advanced Analytics Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Productivity Heatmap -->
                <div class="bg-white rounded-lg shadow-sm p-6 chart-card">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold text-lg">Productivity Heatmap</h3>
                        <div class="flex items-center space-x-2">
                            <button class="chart-action-btn" onclick="chartsManager.exportChart('productivityChart')" title="Export Chart">
                                <i data-feather="download" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="productivityChart"></canvas>
                    </div>
                    <div class="mt-4 flex items-center justify-center space-x-4 text-sm text-gray-600">
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-indigo-200 rounded"></div>
                            <span>Low Activity</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-indigo-600 rounded"></div>
                            <span>High Activity</span>
                        </div>
                    </div>
                </div>

                <!-- Team Performance -->
                <div class="bg-white rounded-lg shadow-sm p-6 chart-card">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold text-lg">Team Contribution</h3>
                        <div class="flex items-center space-x-2">
                            <button class="chart-action-btn" onclick="chartsManager.exportChart('teamChart')" title="Export Chart">
                                <i data-feather="download" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="teamChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Detailed Metrics Table -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="font-semibold text-lg">Detailed Metrics</h3>
                    <div class="flex items-center space-x-2">
                        <input type="text" placeholder="Search metrics..." class="form-input text-sm w-64">
                        <button class="btn btn-outline text-sm">
                            <i data-feather="search" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Metric</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Current Value</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Target</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Trend</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Performance</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="font-medium text-gray-900">Code Coverage</div>
                                    <div class="text-sm text-gray-500">Percentage of code covered by tests</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">85%</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">80%</td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center text-green-600">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span class="text-sm">+7%</span>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">Exceeding</span>
                                </td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="font-medium text-gray-900">Bug Rate</div>
                                    <div class="text-sm text-gray-500">Bugs per 100 lines of code</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">2.1%</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">3.0%</td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center text-green-600">
                                        <i data-feather="trending-down" class="w-4 h-4 mr-1"></i>
                                        <span class="text-sm">-0.4%</span>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">On Target</span>
                                </td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="font-medium text-gray-900">Review Response Time</div>
                                    <div class="text-sm text-gray-500">Average time to first review response</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">4.2h</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">6.0h</td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center text-green-600">
                                        <i data-feather="trending-down" class="w-4 h-4 mr-1"></i>
                                        <span class="text-sm">-1.2h</span>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">Exceeding</span>
                                </td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="font-medium text-gray-900">Deployment Frequency</div>
                                    <div class="text-sm text-gray-500">Deployments per week</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">3.2</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">4.0</td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center text-yellow-600">
                                        <i data-feather="minus" class="w-4 h-4 mr-1"></i>
                                        <span class="text-sm">-0.1</span>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">Below Target</span>
                                </td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="font-medium text-gray-900">Mean Time to Recovery</div>
                                    <div class="text-sm text-gray-500">Average time to fix production issues</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">2.4h</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">4.0h</td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center text-green-600">
                                        <i data-feather="trending-down" class="w-4 h-4 mr-1"></i>
                                        <span class="text-sm">-0.6h</span>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">Exceeding</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Goals and Objectives Widget -->
            <div id="goalsWidget"></div>
        </div>
    </main>

        </div>
    </main>

    <script>
        feather.replace();

        // Initialize Enhanced Charts Manager
        let chartsManager, realTimeIntervals = new Map();
        
        try {
            chartsManager = new ChartsManager();
            
            // Initialize all charts
            chartsManager.createVelocityChart('velocityChart');
            chartsManager.createBurndownChart('burndownChart');
            chartsManager.createCycleTimeChart('cycleTimeChart');
            chartsManager.createCodeQualityChart('codeQualityChart');
            chartsManager.createProductivityHeatmap('productivityChart');
            chartsManager.createTeamPerformanceChart('teamChart');
            
            // Animate charts on load
            setTimeout(() => {
                chartsManager.animateChart('velocityChart', 'progressive');
                chartsManager.animateChart('codeQualityChart', 'progressive');
            }, 500);
            
        } catch (error) {
            console.error('Error initializing charts:', error);
        }

        // Real-time updates toggle
        function toggleRealTime(chartId) {
            if (realTimeIntervals.has(chartId)) {
                clearInterval(realTimeIntervals.get(chartId));
                realTimeIntervals.delete(chartId);
                showToast(`Real-time updates disabled for ${chartId}`, 'info');
            } else {
                const interval = chartsManager.startRealTimeUpdates(chartId, 5000);
                realTimeIntervals.set(chartId, interval);
                showToast(`Real-time updates enabled for ${chartId}`, 'success');
            }
        }

        // Chart interaction enhancements
        document.querySelectorAll('.chart-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-2px)';
                this.style.boxShadow = '0 10px 25px rgba(0,0,0,0.1)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
                this.style.boxShadow = '';
            });
        });

        // Enhanced export functionality
        function exportAllCharts() {
            const chartIds = ['velocityChart', 'burndownChart', 'cycleTimeChart', 'codeQualityChart', 'productivityChart', 'teamChart'];
            chartIds.forEach(chartId => {
                setTimeout(() => {
                    chartsManager.exportChart(chartId);
                }, 100);
            });
            showToast('All charts exported successfully!', 'success');
        }

        // Toast notification helper
        function showToast(message, type = 'info') {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500',
                warning: 'bg-yellow-500'
            };

            const toast = document.createElement('div');
            toast.className = `fixed top-20 right-4 ${colors[type]} text-white p-4 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300`;
            toast.innerHTML = `
                <div class="flex items-center space-x-2">
                    <i data-feather="info" class="w-5 h-5"></i>
                    <span>${message}</span>
                </div>
            `;

            document.body.appendChild(toast);
            feather.replace();

            // Animate in
            setTimeout(() => {
                toast.style.transform = 'translateX(0)';
            }, 100);

            // Remove after 3 seconds
            setTimeout(() => {
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // Dark mode is now handled by DarkModeManager
        // Listen for theme changes to update charts and metrics
        window.addEventListener('themeChanged', (e) => {
            console.log('Theme changed to:', e.detail.theme);
            
            // Update charts for new theme
            if (window.chartsManager && typeof window.chartsManager.updateTheme === 'function') {
                window.chartsManager.updateTheme(window.darkModeManager.getChartColors());
            }
        });

        // Mobile menu toggle
        function toggleMobileMenu() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        }

        // Refresh button functionality
        document.querySelectorAll('button:has([data-feather="refresh-cw"])').forEach(button => {
            button.addEventListener('click', function() {
                const icon = this.querySelector('i');
                icon.classList.add('spin');
                setTimeout(() => {
                    icon.classList.remove('spin');
                    // Add fade-in animation to content
                    document.querySelectorAll('.stat-card, .bg-white').forEach(el => {
                        el.classList.add('fade-in');
                        setTimeout(() => el.classList.remove('fade-in'), 500);
                    });
                }, 1000);
            });
        });

        // Highlight active sidebar link
        const currentPage = window.location.pathname.split('/').pop() || 'index.html';
        document.querySelectorAll('.sidebar-link').forEach(link => {
            if (link.getAttribute('href') === currentPage) {
                link.classList.add('active');
            }
        });

        // Export functionality - Updated to work with sidebar button
        document.querySelectorAll('button:has([data-feather="download"])').forEach(button => {
            button.addEventListener('click', function() {
                alert('Metrics report export functionality will be implemented in Phase 2.');
            });
        });

        // Initialize Goals System
        let goalsManager, goalsWidget;
        
        try {
            // Initialize the goals manager
            goalsManager = new GoalsManager();
            
            // Initialize the goals widget
            const goalsContainer = document.getElementById('goalsWidget');
            if (goalsContainer) {
                goalsWidget = new GoalsWidget(goalsContainer, goalsManager);
                
                // Create some sample goals if none exist
                if (goalsManager.getGoals().length === 0) {
                    // Sample goals for demonstration
                    goalsManager.createGoal({
                        title: 'Improve Code Coverage',
                        description: 'Increase test coverage to 90% by end of Q4',
                        type: 'code_quality',
                        priority: 'high',
                        timeframe: 'quarterly',
                        targetDate: '2024-12-31',
                        targetValue: 90,
                        unit: '%'
                    });
                    
                    // Update progress to 85%
                    const goals = goalsManager.getGoals();
                    if (goals.length > 0) {
                        goalsManager.updateGoalProgress(goals[0].id, 85, 'Added more unit tests and integration tests');
                    }
                    
                    goalsManager.createGoal({
                        title: 'Reduce Cycle Time',
                        description: 'Decrease average cycle time to under 3 days',
                        type: 'productivity',
                        priority: 'medium',
                        timeframe: 'monthly',
                        targetDate: '2024-12-15',
                        targetValue: 3,
                        unit: 'days'
                    });
                    
                    // Mark second goal as completed
                    const allGoals = goalsManager.getGoals();
                    if (allGoals.length > 1) {
                        goalsManager.updateGoalProgress(allGoals[1].id, 3, 'Successfully reduced cycle time through process improvements');
                        goalsManager.completeGoal(allGoals[1].id);
                    }
                }
            }
        } catch (error) {
            console.error('Error initializing goals system:', error);
        }

        // Initialize Help System
        let helpSystem;
        try {
            helpSystem = new HelpSystem();
            
            // Register page-specific tour for metrics page
            helpSystem.registerTour('metrics-deep-dive', {
                name: 'Metrics Deep Dive',
                description: 'Explore advanced engineering metrics and analytics',
                steps: [
                    {
                        element: '.stat-card:first-child',
                        title: 'Key Performance Indicators',
                        content: 'Monitor essential engineering KPIs like velocity, cycle time, and code quality. Click any card to see historical trends.',
                        position: 'bottom'
                    },
                    {
                        element: '#velocityChart',
                        title: 'Sprint Velocity Chart',
                        content: 'Track your team\'s sprint velocity over time. Use the export button to save chart data for reports.',
                        position: 'top'
                    },
                    {
                        element: '#burndownChart',
                        title: 'Burndown Analysis',
                        content: 'Monitor sprint progress with real-time burndown tracking. Toggle real-time updates for live data.',
                        position: 'top'
                    },
                    {
                        element: '.overflow-x-auto table',
                        title: 'Detailed Metrics Table',
                        content: 'Compare current performance against targets. Use the search to filter specific metrics.',
                        position: 'top'
                    },
                    {
                        element: '#goalsWidget',
                        title: 'Goals Integration',
                        content: 'Your SMART goals are integrated with metrics. Track progress and set new targets based on performance data.',
                        position: 'top'
                    }
                ]
            });
            
            // Add keyboard shortcut for help
            document.addEventListener('keydown', (e) => {
                if (e.key === 'F1') {
                    e.preventDefault();
                    helpSystem.toggleHelpPanel();
                }
            });
            
        } catch (error) {
            console.error('Error initializing help system:', error);
        }

        // Dark mode toggle
        document.getElementById('theme-toggle').addEventListener('click', function() {
            document.body.classList.toggle('dark-mode');
            const icon = this.querySelector('i');
            const text = this.querySelector('span');
            if (document.body.classList.contains('dark-mode')) {
                icon.setAttribute('data-feather', 'sun');
                text.textContent = 'Light Mode';
            } else {
                icon.setAttribute('data-feather', 'moon');
                text.textContent = 'Dark Mode';
            }
            feather.replace();
        });

        // Close mobile menu when clicking sidebar links
        document.querySelectorAll('.sidebar-link').forEach(link => {
            link.addEventListener('click', () => {
                const sidebar = document.querySelector('.sidebar');
                const overlay = document.querySelector('.sidebar-overlay');
                
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
            });
        });

        // Close mobile menu on window resize
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 768) {
                const sidebar = document.querySelector('.sidebar');
                const overlay = document.querySelector('.sidebar-overlay');
                
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
            }
        });

        // Dialog functions for + buttons
        function showCreateGoalDialog(event) {
            event.preventDefault();
            event.stopPropagation();
            alert('Create Roadmap Goal dialog would open here. This shows the flow for creating strategic goals.');
        }

        function showCreateProjectDialog(event) {
            event.preventDefault();
            event.stopPropagation();
            alert('Create Project dialog would open here. You would be able to associate this project with roadmap goals.');
        }

        function showCreateSprintDialog(event) {
            event.preventDefault();
            event.stopPropagation();
            alert('Create Sprint dialog would open here. You would be able to attach this sprint to projects or goals.');
        }
        
        function switchProject(projectId) {
            // Navigate directly to the project's Kanban board
            const projectUrls = {
                'all': 'project-tasks.html',
                'platform-modernization': 'platform-modernization.html',
                'mobile-app': 'mobile-app.html',
                'data-analytics': 'data-analytics.html',
                'security-upgrade': 'security-upgrade.html'
            };
            
            if (projectUrls[projectId]) {
                window.location.href = projectUrls[projectId];
            }
        }
    </script>
</body>
</html>